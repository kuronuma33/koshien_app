<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å¶å¤¢~ç”²å­åœ’ã¸ã®é“ã®ã‚Š~</title>
    
    <!-- PWAå¯¾å¿œ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2E7D32">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ç”²å­åœ’ã‚¢ãƒ—ãƒª">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="msapplication-TileImage" content="icon-144.png">
    <meta name="msapplication-TileColor" content="#2E7D32">
    
    <!-- SEOå¯¾å¿œ -->
    <meta name="description" content="ç´ æŒ¯ã‚Šç·´ç¿’ã§ç”²å­åœ’ã‚’ç›®æŒ‡ã™é‡çƒè‚²æˆã‚²ãƒ¼ãƒ ã‚¢ãƒ—ãƒªã€‚ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ ã¨é€²æ—ç®¡ç†ã§æ¥½ã—ãç·´ç¿’ã‚’ç¶šã‘ã‚‰ã‚Œã¾ã™ã€‚">
    <meta name="keywords" content="é‡çƒ,ç”²å­åœ’,ç´ æŒ¯ã‚Š,ç·´ç¿’,ã‚²ãƒ¼ãƒ ,å°å­¦ç”Ÿ,è‚²æˆ">
    <meta name="author" content="ç”²å­åœ’ã‚¢ãƒ—ãƒª">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(180deg, #1976D2 0%, #42A5F5 100%);
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            position: fixed;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh;
            max-width: 400px;
            margin: 0 auto;
            background: linear-gradient(180deg, #E3F2FD 0%, #BBDEFB 100%);
            position: relative;
        }
        
        /* ä¸Šéƒ¨: ç”²å­åœ’ãƒãƒƒãƒ—ã‚¨ãƒªã‚¢ */
        .map-area {
            height: 28vh;
            height: 28dvh;
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            position: relative;
            overflow: hidden;
            border-bottom: 3px solid #1B5E20;
            flex-shrink: 0;
        }
        
        .map-header {
            text-align: center;
            color: white;
            padding: 6px 0;
            background: rgba(0,0,0,0.2);
            font-weight: bold;
            font-size: 13px;
        }
        
        .route-track {
            height: 50px;
            background: rgba(255,255,255,0.3);
            margin: 8px 10px;
            border-radius: 25px;
            position: relative;
            border: 2px solid rgba(255,255,255,0.5);
        }
        
        .route-line {
            position: absolute;
            top: 50%;
            left: 10px;
            right: 10px;
            height: 4px;
            background: rgba(255,255,255,0.6);
            transform: translateY(-50%);
            border-radius: 2px;
        }
        
        .milestone-point {
            position: absolute;
            top: 50%;
            width: 12px;
            height: 12px;
            background: #FFF;
            border-radius: 50%;
            transform: translateY(-50%);
            border: 2px solid #2E7D32;
        }
        
        .milestone-passed {
            background: #4CAF50;
            box-shadow: 0 0 8px #4CAF50;
        }
        
        .player-icon {
            position: absolute;
            top: 50%;
            font-size: 24px;
            transform: translate(-50%, -50%);
            animation: bounce 2s infinite;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            transition: left 0.5s ease;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }
        
        .progress-info {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            color: white;
            font-size: 10px;
            padding: 6px;
            background: rgba(0,0,0,0.2);
        }
        
        .progress-stat {
            text-align: center;
        }
        
        .progress-number {
            font-weight: bold;
            font-size: 12px;
            display: block;
        }
        
        /* ä¸­éƒ¨: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        .character-area {
            height: 32vh;
            height: 32dvh;
            background: linear-gradient(135deg, #FFFFFF, #F5F5F5);
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .character-card {
            background: linear-gradient(135deg, #FFFFFF, #F8F9FA);
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(46, 125, 50, 0.2);
            padding: 12px;
            border: 2px solid #E8F5E8;
            position: relative;
            overflow: hidden;
        }
        
        .character-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(76,175,80,0.1), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .character-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .level-badge {
            background: linear-gradient(135deg, #FF5722, #D32F2F);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 3px 6px rgba(211, 47, 47, 0.3);
        }
        
        .health-display {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .heart-icon {
            font-size: 20px;
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        .heart-full {
            color: #D32F2F;
        }
        
        .heart-empty {
            color: #E0E0E0;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .boost-indicator {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            animation: glow 1s infinite alternate;
            display: none;
        }
        
        .boost-indicator.active {
            display: block;
        }
        
        .chart-btn {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(156, 39, 176, 0.3);
            transition: all 0.2s ease;
        }
        
        .chart-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(156, 39, 176, 0.3);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(244, 67, 54, 0.3);
            transition: all 0.2s ease;
        }
        
        .reset-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(244, 67, 54, 0.3);
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px #FF9800; }
            to { box-shadow: 0 0 15px #FF9800, 0 0 20px #FF9800; }
        }
        
        .daily-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }
        
        .stat-mini {
            text-align: center;
            background: rgba(46, 125, 50, 0.1);
            padding: 6px;
            border-radius: 8px;
            border: 1px solid rgba(46, 125, 50, 0.2);
        }
        
        .stat-mini-number {
            font-weight: bold;
            color: #2E7D32;
            font-size: 14px;
            display: block;
        }
        
        .stat-mini-label {
            font-size: 9px;
            color: #666;
        }
        
        /* ä¸‹éƒ¨: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ */
        .action-area {
            height: 40vh;
            height: 40dvh;
            background: linear-gradient(135deg, #F5F5F5, #E0E0E0);
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .swing-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .swing-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .swing-label {
            font-weight: bold;
            color: #2E7D32;
            flex: 1;
            font-size: 14px;
        }
        
        .swing-counter {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .counter-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(46, 125, 50, 0.3);
            transition: all 0.2s ease;
        }
        
        .counter-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(46, 125, 50, 0.3);
        }
        
        .counter-display {
            font-size: 20px;
            font-weight: bold;
            color: #2E7D32;
            min-width: 45px;
            text-align: center;
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            padding: 6px;
            border-radius: 8px;
            border: 2px solid #C8E6C9;
        }
        
        .main-action-btn {
            background: linear-gradient(135deg, #D32F2F, #F44336);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(211, 47, 47, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .main-action-btn:active {
            transform: translateY(2px);
            box-shadow: 0 4px 8px rgba(211, 47, 47, 0.4);
        }
        
        .main-action-btn:disabled {
            background: #BDBDBD;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .sub-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .sub-action-btn {
            background: linear-gradient(135deg, #1976D2, #2196F3);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 10px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(25, 118, 210, 0.3);
            transition: all 0.2s ease;
        }
        
        .sub-action-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(25, 118, 210, 0.3);
        }
        
        .sub-action-btn:disabled {
            background: #BDBDBD;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .daily-limit-indicator {
            text-align: center;
            background: rgba(25, 118, 210, 0.1);
            color: #1976D2;
            padding: 6px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: bold;
            border: 1px solid rgba(25, 118, 210, 0.2);
        }
        
        /* æˆæœãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: #333;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
            transition: transform 0.3s ease;
            max-width: 280px;
        }
        
        .achievement-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .achievement-popup h2 {
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        /* ãƒãƒ£ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« */
        .chart-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .chart-modal.show {
            display: flex;
        }
        
        .chart-content {
            background: white;
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            max-width: 350px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #E0E0E0;
            padding-bottom: 10px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            color: #2E7D32;
        }
        
        .close-btn {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chart-container {
            width: 100%;
            height: 300px;
            position: relative;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .bar-chart {
            display: flex;
            align-items: end;
            justify-content: space-around;
            height: 250px;
            padding: 20px 10px;
            gap: 8px;
            position: relative;
        }
        
        .line-chart {
            position: relative;
            height: 250px;
            padding: 20px;
        }
        
        .chart-svg {
            width: 100%;
            height: 210px;
        }
        
        .chart-line {
            fill: none;
            stroke: #2E7D32;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .chart-point {
            fill: #4CAF50;
            stroke: #2E7D32;
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chart-point:hover {
            fill: #1B5E20;
            r: 6;
        }
        
        .chart-grid {
            stroke: #E0E0E0;
            stroke-width: 1;
            stroke-dasharray: 3,3;
        }
        
        .chart-label {
            font-size: 10px;
            fill: #666;
            text-anchor: middle;
        }
        
        .chart-value-label {
            font-size: 9px;
            fill: #2E7D32;
            text-anchor: middle;
            font-weight: bold;
        }
        
        .bar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 40px;
        }
        
        .bar {
            width: 100%;
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            position: relative;
            min-height: 10px;
        }
        
        .bar:hover {
            background: linear-gradient(135deg, #1B5E20, #2E7D32);
            transform: scale(1.05);
        }
        
        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: bold;
            color: #2E7D32;
            background: white;
            padding: 2px 4px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .bar:hover .bar-value {
            opacity: 1;
        }
        
        .bar-label {
            font-size: 9px;
            color: #666;
            margin-top: 5px;
            text-align: center;
            transform: rotate(-45deg);
            transform-origin: center;
            white-space: nowrap;
        }
        
        /* ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .confirm-modal.show {
            display: flex;
        }
        
        .confirm-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 320px;
            text-align: center;
            position: relative;
        }
        
        .confirm-title {
            font-size: 20px;
            font-weight: bold;
            color: #f44336;
            margin-bottom: 15px;
        }
        
        .confirm-message {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .confirm-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .confirm-btn {
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .confirm-btn.cancel {
            background: #e0e0e0;
            color: #666;
        }
        
        .confirm-btn.confirm {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }
        
        .confirm-btn:active {
            transform: scale(0.95);
        }
        
        /* ä¿å­˜ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        .save-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #4CAF50;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            animation: saveSlideIn 2s ease-in-out;
        }
        
        @keyframes saveSlideIn {
            0% { opacity: 0; transform: translateX(100%); }
            20% { opacity: 1; transform: translateX(0); }
            80% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(100%); }
        }
        
        /* PWA ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒãƒŠãƒ¼ */
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
            padding: 15px;
            text-align: center;
            z-index: 10000;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
            display: none;
        }
        
        .install-banner.show {
            transform: translateY(0);
        }
        
        .install-banner-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .install-banner-text {
            flex: 1;
            font-size: 14px;
            font-weight: bold;
        }
        
        .install-banner-buttons {
            display: flex;
            gap: 10px;
        }
        
        .install-btn {
            background: white;
            color: #2E7D32;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .install-btn:hover {
            background: #f0f0f0;
        }
        
        .dismiss-btn {
            background: transparent;
            color: white;
            border: 1px solid white;
        }
        
        .dismiss-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€šçŸ¥ */
        .offline-notice {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: #FF5722;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 10000;
            display: none;
        }
        
        .offline-notice.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ä¸Šéƒ¨: ç”²å­åœ’ãƒãƒƒãƒ—ã‚¨ãƒªã‚¢ -->
        <div class="map-area">
            <div class="map-header">
                âš¾ å¶å¤¢~ç”²å­åœ’ã¸ã®é“ã®ã‚Š~ âš¾
            </div>
            <div class="route-track">
                <div class="route-line"></div>
                <div class="milestone-point milestone-passed" style="left: 12.5%;"></div>
                <div class="milestone-point" style="left: 25%;"></div>
                <div class="milestone-point" style="left: 37.5%;"></div>
                <div class="milestone-point" style="left: 50%;"></div>
                <div class="milestone-point" style="left: 62.5%;"></div>
                <div class="milestone-point" style="left: 75%;"></div>
                <div class="milestone-point" style="left: 87.5%;"></div>
                <div class="player-icon" id="playerIcon" style="left: 15%;">ğŸƒâ€â™‚ï¸</div>
            </div>
            <div class="progress-info">
                <div class="progress-stat">
                    <span class="progress-number" id="totalSteps">0</span>
                    <span>ç·æ­©æ•°</span>
                </div>
                <div class="progress-stat">
                    <span class="progress-number" id="nextTarget">ç¥å¥ˆå·çœŒ</span>
                    <span>æ¬¡ã®ç›®æ¨™</span>
                </div>
                <div class="progress-stat">
                    <span class="progress-number" id="remaining">120,192</span>
                    <span>æ¬¡ã¾ã§</span>
                </div>
                <div class="progress-stat">
                    <span class="progress-number" id="totalRemaining">961,538</span>
                    <span>ç”²å­åœ’ã¾ã§</span>
                </div>
            </div>
        </div>
        
        <!-- ä¸­éƒ¨: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
        <div class="character-area">
            <div class="character-card">
                <div class="character-header">
                    <div class="level-badge">Lv.<span id="playerLevel">1</span></div>
                    <div class="health-display">
                        <span style="font-size: 14px; font-weight: bold; color: #666;">ä½“åŠ›:</span>
                        <div id="healthHearts">
                            <span class="heart-icon heart-full">â™¥</span>
                            <span class="heart-icon heart-full">â™¥</span>
                            <span class="heart-icon heart-full">â™¥</span>
                        </div>
                    </div>
                </div>
                
                <div class="status-row">
                    <div style="color: #666; font-size: 14px;">
                        ğŸ“… <span id="currentDate">2025å¹´8æœˆ13æ—¥</span>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="chart-btn" onclick="showChart()">ğŸ“Š ã‚°ãƒ©ãƒ•</button>
                        <button class="reset-btn" onclick="resetAllData()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin: 6px 0;">
                    <div class="boost-indicator" id="boostIndicator">
                        ğŸš€ ãƒ–ãƒ¼ã‚¹ãƒˆåŠ¹æœä¸­ï¼
                    </div>
                </div>
                
                <div class="daily-stats">
                    <div class="stat-mini">
                        <span class="stat-mini-number" id="todaySwings">0</span>
                        <span class="stat-mini-label">ä»Šæ—¥ã®ç´ æŒ¯ã‚Š</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-mini-number" id="todaySteps">0</span>
                        <span class="stat-mini-label">ä»Šæ—¥ã®æ­©æ•°</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-mini-number" id="consecutiveDays">0</span>
                        <span class="stat-mini-label">é€£ç¶šæ—¥æ•°</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¸‹éƒ¨: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ -->
        <div class="action-area">
            <div class="swing-section">
                <div class="swing-input-row">
                    <div class="swing-label">âš¾ ç´ æŒ¯ã‚Šå›æ•°</div>
                    <div class="swing-counter">
                        <button class="counter-btn" onclick="changeCount(-10)">-</button>
                        <div class="counter-display" id="swingCount">50</div>
                        <button class="counter-btn" onclick="changeCount(10)">+</button>
                    </div>
                </div>
                
                <button class="main-action-btn" id="swingBtn" onclick="executeSwing()">
                    âš¾ ç´ æŒ¯ã‚Šå®Ÿè¡Œï¼
                </button>
                
                <div class="daily-limit-indicator">
                    ä½“åŠ›: <span id="healthText">â™¥â™¥â™¥</span> | æŸ”è»Ÿã§1ãƒãƒ¼ãƒˆå›å¾©
                </div>
            </div>
            
            <div class="sub-actions">
                <button class="sub-action-btn" id="dashBtn" onclick="executeDash()">
                    ğŸƒâ€â™‚ï¸ ç·´ç¿’æ—¥
                </button>
                <button class="sub-action-btn" id="flexBtn" onclick="executeFlexibility()">
                    ğŸ§˜â€â™‚ï¸ æŸ”è»Ÿä½“æ“
                </button>
            </div>
        </div>
    </div>
    
    <!-- æˆæœãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="achievement-popup" id="achievementPopup">
        <h2>ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼ ğŸ‰</h2>
        <p id="achievementText"></p>
    </div>
    
    <!-- ãƒãƒ£ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="chart-modal" id="chartModal">
        <div class="chart-content">
            <div class="chart-header">
                <div class="chart-title">ğŸ“Š ç´ æŒ¯ã‚Šå›æ•°ã®æ¨ç§»</div>
                <button class="close-btn" onclick="hideChart()">Ã—</button>
            </div>
            <div class="chart-container">
                <div class="bar-chart" id="barChart">
                    <!-- å‹•çš„ã«ç·šã‚°ãƒ©ãƒ•ã‚’ç”Ÿæˆ -->
                </div>
            </div>
            <div style="margin-top: 15px; text-align: center; color: #666; font-size: 12px;">
                éå»7æ—¥é–“ã®ç´ æŒ¯ã‚Šå›æ•°ã®æ¨ç§»
            </div>
        </div>
    </div>
    
    <!-- ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-title">âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</div>
            <div class="confirm-message">
                æœ¬å½“ã«å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ<br>
                <strong>ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚</strong>
            </div>
            <div class="confirm-buttons">
                <button class="confirm-btn cancel" onclick="hideConfirm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="confirm-btn confirm" onclick="confirmReset()">ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ</button>
            </div>
        </div>
    </div>
    
    <!-- PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒãƒŠãƒ¼ -->
    <div class="install-banner" id="installBanner">
        <div class="install-banner-content">
            <div class="install-banner-text">
                ğŸ“± ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ãˆã¾ã™ï¼
            </div>
            <div class="install-banner-buttons">
                <button class="install-btn" id="installBtn">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
                <button class="install-btn dismiss-btn" id="dismissBtn">å¾Œã§</button>
            </div>
        </div>
    </div>
    
    <!-- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€šçŸ¥ -->
    <div class="offline-notice" id="offlineNotice">
        ğŸ“¶ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ã™
    </div>
    
    <script>
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        let gameData = {
            totalSteps: 0,
            totalSwings: 0,
            health: 3,
            hasBoost: false,
            swingInputCount: 0,
            lastDate: null,
            consecutiveDays: 0,
            currentLevel: 1,
            todayData: {
                swings: 0,
                steps: 0,
                distance: 0
            },
            swingCount: 50,
            dailyHistory: []
        };
        
        // ç›®æ¨™è¨­å®š
        const TOTAL_DISTANCE_KM = 500;
        const STEP_DISTANCE_M = 0.52;
        const TOTAL_STEPS = Math.ceil(TOTAL_DISTANCE_KM * 1000 / STEP_DISTANCE_M);
        
        // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¨­å®š
        const milestones = [
            { name: "ç¥å¥ˆå·çœŒ", steps: Math.floor(TOTAL_STEPS * 0.125) },
            { name: "é™å²¡çœŒ", steps: Math.floor(TOTAL_STEPS * 0.25) },
            { name: "æ„›çŸ¥çœŒ", steps: Math.floor(TOTAL_STEPS * 0.375) },
            { name: "å²é˜œçœŒ", steps: Math.floor(TOTAL_STEPS * 0.5) },
            { name: "æ»‹è³€çœŒ", steps: Math.floor(TOTAL_STEPS * 0.625) },
            { name: "äº¬éƒ½åºœ", steps: Math.floor(TOTAL_STEPS * 0.75) },
            { name: "å¤§é˜ªåºœ", steps: Math.floor(TOTAL_STEPS * 0.875) },
            { name: "ç”²å­åœ’çƒå ´", steps: TOTAL_STEPS }
        ];
        
        // ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—ã—ã¦è¡¨ç¤º
        function updateDate() {
            const today = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'short'
            };
            const dateString = today.toLocaleDateString('ja-JP', options);
            document.getElementById('currentDate').textContent = dateString;
        }
        
        // ã‚«ã‚¦ãƒ³ãƒˆå¤‰æ›´
        function changeCount(change) {
            gameData.swingCount = Math.max(0, gameData.swingCount + change);
            document.getElementById('swingCount').textContent = gameData.swingCount;
        }
        
        // ç´ æŒ¯ã‚Šå®Ÿè¡Œ
        function executeSwing() {
            const swingCount = gameData.swingCount;
            
            if (swingCount <= 0) {
                showAchievement("ç´ æŒ¯ã‚Šå›æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼");
                return;
            }
            
            if (gameData.health <= 0) {
                showAchievement("ä½“åŠ›ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼\næŸ”è»Ÿä½“æ“ã§å›å¾©ã—ã¦ãã ã•ã„ã€‚");
                return;
            }
            
            // ä½“åŠ›æ¶ˆè²»
            gameData.health--;
            gameData.swingInputCount++;
            
            // æ­©æ•°è¨ˆç®—ï¼ˆãƒ–ãƒ¼ã‚¹ãƒˆåŠ¹æœé©ç”¨ï¼‰
            const stepsPerSwing = gameData.hasBoost ? 15 : 10;
            const stepsGained = swingCount * stepsPerSwing;
            
            // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
            gameData.totalSteps += stepsGained;
            gameData.totalSwings += swingCount;
            gameData.todayData.swings += swingCount;
            gameData.todayData.steps += stepsGained;
            
            // å…¥åŠ›ãƒªã‚»ãƒƒãƒˆ
            gameData.swingCount = 0;
            
            // è¡¨ç¤ºæ›´æ–°
            updateDisplay();
            updateMap();
            saveGameData();
            
            // æˆæœè¡¨ç¤º
            showAchievement(`ç´ æŒ¯ã‚Š ${swingCount}å› å®Œäº†ï¼\n${stepsGained}æ­©å‰é€²ã—ã¾ã—ãŸï¼`);
            
            // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
            checkLevelUp();
        }
        
        // ãƒ€ãƒƒã‚·ãƒ¥å®Ÿè¡Œ
        function executeDash() {
            if (gameData.hasBoost) {
                showAchievement("ä»Šæ—¥ã¯ã™ã§ã«ç·´ç¿’æ¸ˆã¿ï¼");
                return;
            }
            
            gameData.hasBoost = true;
            document.getElementById('boostIndicator').classList.add('active');
            document.getElementById('dashBtn').disabled = true;
            document.getElementById('dashBtn').textContent = 'âœ… å®Œäº†';
            
            saveGameData();
            showAchievement("ç·´ç¿’å®Œäº†ï¼\nç´ æŒ¯ã‚ŠåŠ¹æœãŒã‚¢ãƒƒãƒ—ï¼\nï¼ˆ1å› = 15æ­©ï¼‰");
        }
        
        // æŸ”è»Ÿå®Ÿè¡Œ
        function executeFlexibility() {
            if (gameData.health >= 3) {
                showAchievement("ä½“åŠ›ã¯æœ€å¤§ã§ã™ï¼");
                return;
            }
            
            gameData.health = Math.min(3, gameData.health + 1);
            updateDisplay();
            saveGameData();
            showAchievement("æŸ”è»Ÿä½“æ“å®Œäº†ï¼\nä½“åŠ›ãŒ1å›å¾©ã—ã¾ã—ãŸï¼");
        }
        
        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            // åŸºæœ¬æƒ…å ±
            document.getElementById('totalSteps').textContent = gameData.totalSteps.toLocaleString();
            document.getElementById('playerLevel').textContent = gameData.currentLevel;
            document.getElementById('swingCount').textContent = gameData.swingCount;
            
            // ä»Šæ—¥ã®è¨˜éŒ²
            document.getElementById('todaySwings').textContent = gameData.todayData.swings;
            document.getElementById('todaySteps').textContent = gameData.todayData.steps;
            document.getElementById('consecutiveDays').textContent = gameData.consecutiveDays;
            
            // ä½“åŠ›è¡¨ç¤º
            const hearts = document.querySelectorAll('.heart-icon');
            hearts.forEach((heart, index) => {
                if (index < gameData.health) {
                    heart.className = 'heart-icon heart-full';
                } else {
                    heart.className = 'heart-icon heart-empty';
                }
            });
            
            // ä½“åŠ›ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
            let healthText = '';
            for (let i = 0; i < 3; i++) {
                healthText += i < gameData.health ? 'â™¥' : 'â™¡';
            }
            document.getElementById('healthText').textContent = healthText;
            
            // æ¬¡ã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
            updateNextTarget();
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹
            const swingBtn = document.getElementById('swingBtn');
            if (gameData.health <= 0) {
                swingBtn.disabled = true;
                swingBtn.textContent = 'ğŸ˜° ä½“åŠ›ä¸è¶³';
            } else {
                swingBtn.disabled = false;
                swingBtn.textContent = 'âš¾ ç´ æŒ¯ã‚Šå®Ÿè¡Œï¼';
            }
        }
        
        // æ¬¡ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ›´æ–°
        function updateNextTarget() {
            const nextMilestone = milestones.find(m => m.steps > gameData.totalSteps);
            if (nextMilestone) {
                const stepsToNext = nextMilestone.steps - gameData.totalSteps;
                const stepsToGoal = TOTAL_STEPS - gameData.totalSteps;
                document.getElementById('nextTarget').textContent = nextMilestone.name;
                document.getElementById('remaining').textContent = stepsToNext.toLocaleString();
                document.getElementById('totalRemaining').textContent = stepsToGoal.toLocaleString();
            } else {
                document.getElementById('nextTarget').textContent = 'ğŸ‰ åˆ°é”ï¼';
                document.getElementById('remaining').textContent = '0';
                document.getElementById('totalRemaining').textContent = '0';
            }
        }
        
        // åœ°å›³æ›´æ–°
        function updateMap() {
            const progress = Math.min(100, (gameData.totalSteps / TOTAL_STEPS) * 100);
            document.getElementById('playerIcon').style.left = Math.max(5, progress) + '%';
            
            // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã®é”æˆçŠ¶æ³ã‚’æ›´æ–°
            const milestonePoints = document.querySelectorAll('.milestone-point');
            milestonePoints.forEach((point, index) => {
                if (index < milestones.length && gameData.totalSteps >= milestones[index].steps) {
                    point.classList.add('milestone-passed');
                } else {
                    point.classList.remove('milestone-passed');
                }
            });
        }
        
        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
        function checkLevelUp() {
            const newLevel = Math.floor(gameData.totalSteps / 1000) + 1;
            if (newLevel > gameData.currentLevel) {
                gameData.currentLevel = newLevel;
                showAchievement(`ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ ğŸ‰\nãƒ¬ãƒ™ãƒ« ${newLevel} ã«ãªã‚Šã¾ã—ãŸï¼`);
                updateDisplay();
            }
        }
        
        // æˆæœè¡¨ç¤º
        function showAchievement(text) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementText').textContent = text;
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }
        
        // ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º
        function showChart() {
            const modal = document.getElementById('chartModal');
            const barChart = document.getElementById('barChart');
            
            // ãƒãƒ£ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢
            barChart.innerHTML = '';
            
            // æœ€æ–°7æ—¥åˆ†ã®å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            let recentData = [];
            const today = new Date();
            
            // éå»7æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = date.toDateString();
                
                // å±¥æ­´ã‹ã‚‰è©²å½“æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¢ã™
                const existingData = gameData.dailyHistory.find(d => d.date === dateString);
                
                if (existingData) {
                    recentData.push(existingData);
                } else if (i === 0) {
                    // ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿
                    recentData.push({
                        date: dateString,
                        swings: gameData.todayData.swings,
                        steps: gameData.todayData.steps
                    });
                } else {
                    // ãƒ‡ãƒ¼ã‚¿ãŒãªã„æ—¥ã¯0ã¨ã—ã¦è¿½åŠ 
                    recentData.push({
                        date: dateString,
                        swings: 0,
                        steps: 0
                    });
                }
            }
            
            // ç·šã‚°ãƒ©ãƒ•ã‚’ç”Ÿæˆ
            createLineChart(barChart, recentData);
            modal.classList.add('show');
        }
        
        // ç·šã‚°ãƒ©ãƒ•ä½œæˆ
        function createLineChart(container, data) {
            const maxSwings = Math.max(...data.map(d => d.swings), 50);
            const width = 300;
            const height = 210;
            const padding = 40;
            
            // SVGè¦ç´ ã‚’ä½œæˆ
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('class', 'chart-svg');
            svg.setAttribute('viewBox', `0 0 ${width + padding * 2} ${height + padding * 2}`);
            
            // ã‚°ãƒªãƒƒãƒ‰ç·šã‚’æç”»
            for (let i = 0; i <= 5; i++) {
                const y = padding + (height / 5) * i;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('class', 'chart-grid');
                line.setAttribute('x1', padding);
                line.setAttribute('y1', y);
                line.setAttribute('x2', width + padding);
                line.setAttribute('y2', y);
                svg.appendChild(line);
                
                // Yè»¸ãƒ©ãƒ™ãƒ«
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('class', 'chart-label');
                label.setAttribute('x', padding - 10);
                label.setAttribute('y', y + 3);
                label.setAttribute('text-anchor', 'end');
                label.textContent = Math.round(maxSwings - (maxSwings / 5) * i);
                svg.appendChild(label);
            }
            
            // ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¨ç·šã‚’æç”»
            let pathData = '';
            data.forEach((dayData, index) => {
                const x = padding + (width / (data.length - 1)) * index;
                const y = padding + height - (dayData.swings / maxSwings) * height;
                
                // ãƒ‘ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰
                if (index === 0) {
                    pathData += `M ${x} ${y}`;
                } else {
                    pathData += ` L ${x} ${y}`;
                }
                
                // ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’æç”»
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('class', 'chart-point');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', 4);
                
                // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—åŠ¹æœ
                circle.addEventListener('mouseenter', function() {
                    const valueLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    valueLabel.setAttribute('class', 'chart-value-label');
                    valueLabel.setAttribute('id', 'temp-label');
                    valueLabel.setAttribute('x', x);
                    valueLabel.setAttribute('y', y - 10);
                    valueLabel.textContent = dayData.swings;
                    svg.appendChild(valueLabel);
                });
                
                circle.addEventListener('mouseleave', function() {
                    const tempLabel = svg.querySelector('#temp-label');
                    if (tempLabel) tempLabel.remove();
                });
                
                svg.appendChild(circle);
                
                // Xè»¸ãƒ©ãƒ™ãƒ«ï¼ˆæ—¥ä»˜ï¼‰
                const date = new Date(dayData.date);
                const dateLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                dateLabel.setAttribute('class', 'chart-label');
                dateLabel.setAttribute('x', x);
                dateLabel.setAttribute('y', height + padding + 20);
                dateLabel.textContent = `${date.getMonth() + 1}/${date.getDate()}`;
                svg.appendChild(dateLabel);
            });
            
            // ç·šã‚’æç”»
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('class', 'chart-line');
            path.setAttribute('d', pathData);
            svg.appendChild(path);
            
            // ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ 
            container.appendChild(svg);
        }
        
        // ãƒãƒ£ãƒ¼ãƒˆéè¡¨ç¤º
        function hideChart() {
            const modal = document.getElementById('chartModal');
            modal.classList.remove('show');
        }
        
        // ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆç¢ºèª
        function resetAllData() {
            const modal = document.getElementById('confirmModal');
            modal.classList.add('show');
        }
        
        // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
        function hideConfirm() {
            const modal = document.getElementById('confirmModal');
            modal.classList.remove('show');
        }
        
        // ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ
        function confirmReset() {
            // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
            gameData = {
                totalSteps: 0,
                totalSwings: 0,
                health: 3,
                hasBoost: false,
                swingInputCount: 0,
                lastDate: new Date().toDateString(),
                consecutiveDays: 0,
                currentLevel: 1,
                todayData: {
                    swings: 0,
                    steps: 0,
                    distance: 0
                },
                swingCount: 50,
                dailyHistory: []
            };
            
            // LocalStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
            try {
                localStorage.removeItem('koshienGameData');
            } catch (e) {
                console.log('LocalStorageå‰Šé™¤ã‚’ã‚¹ã‚­ãƒƒãƒ—');
            }
            
            // UIã‚’ãƒªã‚»ãƒƒãƒˆ
            resetDailyUI();
            
            // è¡¨ç¤ºã‚’æ›´æ–°
            updateDisplay();
            updateMap();
            
            // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveGameData();
            
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
            hideConfirm();
            
            // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            showAchievement('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼\næ–°ã—ã„æ—…ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼ğŸ‰');
        }
        
        // ä¿å­˜ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
        function showSaveIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'save-indicator';
            indicator.textContent = 'ğŸ’¾ ä¿å­˜å®Œäº†';
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
            }, 2000);
        }
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆLocalStorageã‚’ä½¿ç”¨ï¼‰
        function saveGameData() {
            try {
                const dataToSave = JSON.stringify(gameData);
                localStorage.setItem('koshienGameData', dataToSave);
                showSaveIndicator();
                console.log('ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                // LocalStorageãŒä½¿ãˆãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                try {
                    // ãƒ¡ã‚¿ã‚¿ã‚°ã‚’ä½¿ã£ãŸä¿å­˜ï¼ˆåˆ¶é™çš„ã ãŒä½•ã‚‚ãªã„ã‚ˆã‚Šã¾ã—ï¼‰
                    let metaData = document.querySelector('meta[name="game-data"]');
                    if (!metaData) {
                        metaData = document.createElement('meta');
                        metaData.name = 'game-data';
                        document.head.appendChild(metaData);
                    }
                    metaData.content = JSON.stringify(gameData);
                } catch (fallbackError) {
                    console.error('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä¿å­˜ã‚‚å¤±æ•—:', fallbackError);
                }
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆLocalStorageã‹ã‚‰ï¼‰
        function loadGameData() {
            try {
                const savedData = localStorage.getItem('koshienGameData');
                if (savedData) {
                    const loadedData = JSON.parse(savedData);
                    if (loadedData && typeof loadedData === 'object') {
                        gameData = { ...gameData, ...loadedData };
                        console.log('ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                        return true;
                    }
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãƒ¡ã‚¿ã‚¿ã‚°ã‹ã‚‰èª­ã¿è¾¼ã¿
                try {
                    const metaData = document.querySelector('meta[name="game-data"]');
                    if (metaData && metaData.content) {
                        const loadedData = JSON.parse(metaData.content);
                        if (loadedData && typeof loadedData === 'object') {
                            gameData = { ...gameData, ...loadedData };
                            console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                            return true;
                        }
                    }
                } catch (fallbackError) {
                    console.error('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯èª­ã¿è¾¼ã¿ã‚‚å¤±æ•—:', fallbackError);
                }
            }
            return false;
        }
        
        // æ—¥ä»˜ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ï¼ˆä¿®æ­£ç‰ˆï¼‰
        function checkNewDay() {
            const today = new Date().toDateString();
            
            if (gameData.lastDate !== today) {
                // å‰æ—¥ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯å±¥æ­´ã«ä¿å­˜
                if (gameData.lastDate && gameData.todayData.swings > 0) {
                    gameData.dailyHistory.push({
                        date: gameData.lastDate,
                        swings: gameData.todayData.swings,
                        steps: gameData.todayData.steps
                    });
                    
                    // å±¥æ­´ã¯30æ—¥åˆ†ã¾ã§ä¿æŒ
                    if (gameData.dailyHistory.length > 30) {
                        gameData.dailyHistory = gameData.dailyHistory.slice(-30);
                    }
                    
                    // é€£ç¶šæ—¥æ•°ã®è¨ˆç®—
                    const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toDateString();
                    if (gameData.lastDate === yesterday && gameData.todayData.swings > 0) {
                        gameData.consecutiveDays++;
                    } else {
                        gameData.consecutiveDays = gameData.todayData.swings > 0 ? 1 : 0;
                    }
                } else if (!gameData.lastDate) {
                    // åˆå›èµ·å‹•æ™‚
                    gameData.consecutiveDays = 0;
                } else {
                    // å‰æ—¥ã«ç·´ç¿’ã—ã¦ã„ãªã„å ´åˆ
                    gameData.consecutiveDays = 0;
                }
                
                // ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
                gameData.todayData = { swings: 0, steps: 0, distance: 0 };
                gameData.swingInputCount = 0;
                gameData.health = 3;
                gameData.hasBoost = false;
                gameData.lastDate = today;
                
                // UIã‚‚ãƒªã‚»ãƒƒãƒˆ
                resetDailyUI();
                
                console.log('æ–°ã—ã„æ—¥ã«ãªã‚Šã¾ã—ãŸ:', today);
            }
        }
        
        // æ—¥æ¬¡UIãƒªã‚»ãƒƒãƒˆ
        function resetDailyUI() {
            document.getElementById('boostIndicator').classList.remove('active');
            document.getElementById('dashBtn').disabled = false;
            document.getElementById('dashBtn').textContent = 'ğŸƒâ€â™‚ï¸ ç·´ç¿’æ—¥';
        }
        
        // è‡ªå‹•ä¿å­˜ã®è¨­å®š
        function setupAutoSave() {
            // 30ç§’ã”ã¨ã«è‡ªå‹•ä¿å­˜
            setInterval(saveGameData, 30000);
            
            // ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã‚‹æ™‚ã«ä¿å­˜
            window.addEventListener('beforeunload', saveGameData);
            
            // ã‚¿ãƒ–ãŒéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸæ™‚ã«ä¿å­˜
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'hidden') {
                    saveGameData();
                }
            });
        }
        
        // PWAé–¢é€£ã®å¤‰æ•°
        let deferredPrompt;
        let isInstalled = false;
        
        // Service Workerç™»éŒ²
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('Service Workerç™»éŒ²æˆåŠŸ:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Workerç™»éŒ²å¤±æ•—:', error);
                    });
            });
        }
        
        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½æ™‚ã®å‡¦ç†
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½');
            e.preventDefault();
            deferredPrompt = e;
            showInstallBanner();
        });
        
        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒãƒŠãƒ¼è¡¨ç¤º
        function showInstallBanner() {
            // æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã¾ãŸã¯ä»¥å‰ã«éè¡¨ç¤ºã«ã—ãŸå ´åˆã¯è¡¨ç¤ºã—ãªã„
            if (isInstalled || localStorage.getItem('install-banner-dismissed')) {
                return;
            }
            
            const banner = document.getElementById('installBanner');
            banner.style.display = 'block';
            setTimeout(() => {
                banner.classList.add('show');
            }, 3000); // 3ç§’å¾Œã«è¡¨ç¤º
        }
        
        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çµæœ: ${outcome}`);
                deferredPrompt = null;
            }
            hideInstallBanner();
        });
        
        // å¾Œã§ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
        document.getElementById('dismissBtn').addEventListener('click', () => {
            hideInstallBanner();
            try {
                localStorage.setItem('install-banner-dismissed', 'true');
            } catch (e) {
                console.log('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒãƒŠãƒ¼éè¡¨ç¤ºè¨­å®šã®ä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—');
            }
        });
        
        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒãƒŠãƒ¼éè¡¨ç¤º
        function hideInstallBanner() {
            const banner = document.getElementById('installBanner');
            banner.classList.remove('show');
        }
        
        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã®å‡¦ç†
        window.addEventListener('appinstalled', () => {
            console.log('PWAãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸ');
            isInstalled = true;
            hideInstallBanner();
            showAchievement('ã‚¢ãƒ—ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸï¼\nãƒ›ãƒ¼ãƒ ç”»é¢ã‹ã‚‰èµ·å‹•ã§ãã¾ã™ğŸ‰');
        });
        
        // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã®ç›£è¦–
        function updateOnlineStatus() {
            const offlineNotice = document.getElementById('offlineNotice');
            if (navigator.onLine) {
                offlineNotice.classList.remove('show');
            } else {
                offlineNotice.classList.add('show');
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // åˆæœŸåŒ–å‡¦ç†
        function init() {
            console.log('ã‚¢ãƒ—ãƒªã‚’åˆæœŸåŒ–ä¸­...');
            
            // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
            updateOnlineStatus();
            
            // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            const dataLoaded = loadGameData();
            console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿çµæœ:', dataLoaded);
            
            // æ–°ã—ã„æ—¥ã‹ãƒã‚§ãƒƒã‚¯
            checkNewDay();
            
            // è‡ªå‹•ä¿å­˜è¨­å®š
            setupAutoSave();
            
            // æ—¥ä»˜è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆç¾åœ¨ã®æ—¥ä»˜ï¼‰
            updateDate();
            
            // è¡¨ç¤ºæ›´æ–°
            updateDisplay();
            updateMap();
            
            // ãƒ–ãƒ¼ã‚¹ãƒˆçŠ¶æ…‹ã®å¾©å…ƒ
            if (gameData.hasBoost) {
                document.getElementById('boostIndicator').classList.add('active');
                document.getElementById('dashBtn').disabled = true;
                document.getElementById('dashBtn').textContent = 'âœ… å®Œäº†';
            }
            
            // åˆå›èµ·å‹•æ™‚ã®æ—¥ä»˜è¨­å®š
            if (!gameData.lastDate) {
                gameData.lastDate = new Date().toDateString();
                saveGameData();
                console.log('åˆå›èµ·å‹•: æ—¥ä»˜ã‚’è¨­å®šã—ã¾ã—ãŸ');
            }
            
            // ãƒ¬ãƒ™ãƒ«å†è¨ˆç®—
            gameData.currentLevel = Math.floor(gameData.totalSteps / 1000) + 1;
            updateDisplay();
            
            console.log('åˆæœŸåŒ–å®Œäº†');
            console.log('ç¾åœ¨ã®ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿:', gameData);
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', init);
        
        // ãƒšãƒ¼ã‚¸ã®å¯è¦–æ€§ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ï¼ˆã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãªã©ï¼‰
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // ãƒšãƒ¼ã‚¸ãŒå†ã³è¡¨ç¤ºã•ã‚ŒãŸæ™‚ã€æ—¥ä»˜ã‚’ãƒã‚§ãƒƒã‚¯
                checkNewDay();
                updateDate();
                updateDisplay();
            }
        });
        
        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒæˆ»ã£ãŸæ™‚ã‚‚æ—¥ä»˜ã‚’ãƒã‚§ãƒƒã‚¯
        window.addEventListener('focus', function() {
            checkNewDay();
            updateDate();
            updateDisplay();
        });
    </script>
</body>
</html>
